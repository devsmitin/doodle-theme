{% comment %} image-tag {% endcomment %}


{% liquid
  assign img_width = width | default: 8
  assign image_alt = image_alt | escape
  assign src_widths = '200, 400, 600, 800, 1000, 1200, 1400, 1600, 2000' | split: ','
  assign widths = ""
  for width in src_widths
    assign width_num = width | times: 1

    if width_num < image.width
      assign widths = widths | append: ',' | append: width_num
    else
      assign widths = widths | append: ',' | append: image.width
      break
    endif
  endfor

  if class_list != nil
    assign class_list = class_list | append: ' img-fluid'
  else
    assign class_list = 'img-fluid'
  endif

  if settings.lazy_images 
    assign class_list = class_list | append: ' zload'
  endif

  assign widths = widths | remove_first: ','
  assign master_img = image | image_url: width: image.width
%}

{% if settings.lazy_images %}
  {{ image 
    | image_url: width: img_width, format: 'pjpg'
    | image_tag: width: image.width, height: image.height, widths: widths, class: class_list, alt: image_alt, loading: 'lazy', data-src: master_img }}
{% else %}
  {% comment %} <img
    src="{{ image | image_url: width: '2000x' }}"
    class="{{ class_list }}" alt="{{ image_alt | escape }}"
    data-src= "{{ image | image_url: width: image.width, format: 'pjpg' }}"
    loading="lazy"
    width="{{ image.width }}"
    height="{{ image.height }}"
    data-test="{{ image.id }}"
  > {% endcomment %}

  <img data-width="{{ image.width }}" srcset="{% if image.width >= 493 %}{{ image | image_url: width: 493 }} 493w,{% endif %}
      {% if image.width >= 600 %}{{ image | image_url: width: 600 }} 600w,{% endif %}
      {% if image.width >= 713 %}{{ image | image_url: width: 713 }} 713w,{% endif %}
      {% if image.width >= 823 %}{{ image | image_url: width: 823 }} 823w,{% endif %}
      {% if image.width >= 990 %}{{ image | image_url: width: 990 }} 990w,{% endif %}
      {% if image.width >= 1100 %}{{ image | image_url: width: 1100 }} 1100w,{% endif %}
      {% if image.width >= 1206 %}{{ image | image_url: width: 1206 }} 1206w,{% endif %}
      {% if image.width >= 1346 %}{{ image | image_url: width: 1346 }} 1346w,{% endif %}
      {% if image.width >= 1426 %}{{ image | image_url: width: 1426 }} 1426w,{% endif %}
      {% if image.width >= 1646 %}{{ image | image_url: width: 1646 }} 1646w,{% endif %}
      {% if image.width >= 1946 %}{{ image | image_url: width: 1946 }} 1946w,{% endif %}
      {{ image | image_url }} {{ image.width }}w"
    src="{{ media | image_url: width: 1946 }}"
    class="{{ class_list }}" alt="{{ image_alt | escape }}"
    width="auto"
    height="auto"
    loading="lazy"
  >
{% endif %}
